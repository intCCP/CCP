/* Formatted on 21/07/2014 18:36:02 (QP5 v5.227.12220.39754) */
CREATE OR REPLACE FORCE VIEW MCRE_OWN.V_MCRE0_APP_SCHEDA_ANAG_HST
(
   COD_ABI_CARTOLARIZZATO,
   DESC_ISTITUTO,
   COD_NDG,
   DESC_NOME_CONTROPARTE,
   COD_SNDG,
   COD_GRUPPO_ECONOMICO,
   COD_GRUPPO_LEGAME,
   COD_SNDG_GE,
   COD_COMPARTO,
   COD_STRUTTURA_COMPETENTE,
   NOME,
   COGNOME,
   COD_STRUTTURA_COMPETENTE_DC,
   DESC_STRUTTURA_COMPETENTE_DC,
   COD_STRUTTURA_COMPETENTE_RG,
   DESC_STRUTTURA_COMPETENTE_RG,
   COD_STRUTTURA_COMPETENTE_AR,
   DESC_STRUTTURA_COMPETENTE_AR,
   COD_STRUTTURA_COMPETENTE_FI,
   DESC_STRUTTURA_COMPETENTE_FI,
   COD_STATO,
   COD_PROCESSO,
   VAL_GG_INTERCETTAMENTO,
   DTA_SCADENZA_STATO,
   DTA_LAST_DEL_FIDO,
   DTA_LAST_PEF_PROPOSTA,
   FLG_FIDI_SCADUTI,
   DTA_SCADENZA_FIDO,
   VAL_LAST_FASE_PEF,
   VAL_STRATEGIA_CREDIT,
   VAL_LAST_ORGANO_DEL_CP,
   VAL_CONTRASS_ORGANO_DEL_CP,
   FLG_CONFERMA_SAG,
   FLG_ALLINEATO_SAG,
   VAL_SCONFINO,
   DTA_LAST_UPDATE,
   COD_STATO_PRECEDENTE,
   DTA_DECORRENZA_STATO,
   COD_PERCORSO,
   VAL_RWA
)
AS
   SELECT /*+full(e) index(e,IB1_t_mcre0_app_storico_eventi)*/
         ST.COD_ABI_CARTOLARIZZATO,
          I.DESC_ISTITUTO,
          ST.COD_NDG,
          ST.DESC_NOME_CONTROPARTE,
          ST.COD_SNDG,
          ST.COD_GRUPPO_ECONOMICO,
          ST.COD_GRUPPO_LEGAME,
          ST.COD_SNDG COD_SNDG_GE,
          NVL (ST.COD_COMPARTO_ASSEGNATO, ST.COD_COMPARTO_CALCOLATO)
             COD_COMPARTO,
          ST.COD_STRUTTURA_COMPETENTE,
          U.NOME,
          U.COGNOME,
          S.COD_STRUTTURA_COMPETENTE_DC,
          S.DESC_STRUTTURA_COMPETENTE_DC,
          S.COD_STRUTTURA_COMPETENTE_RG,
          S.DESC_STRUTTURA_COMPETENTE_RG,
          S.COD_STRUTTURA_COMPETENTE_AR,
          S.DESC_STRUTTURA_COMPETENTE_AR,
          S.COD_STRUTTURA_COMPETENTE_FI,
          S.DESC_STRUTTURA_COMPETENTE_FI,
          ST.COD_STATO,
          ST.COD_PROCESSO,
          TRUNC (SYSDATE) - TRUNC (ST.DTA_INTERCETTAMENTO)
             VAL_GG_INTERCETTAMENTO,
          ST.DTA_SCADENZA_STATO,
          ST.DTA_COMPLETAMENTO_PEF DTA_LAST_DEL_FIDO,
          DTA_ULTIMA_REVISIONE_PEF DTA_LAST_PEF_PROPOSTA,
          ST.FLG_FIDI_SCADUTI AS FLG_FIDI_SCADUTI,
          ST.DAT_ULTIMO_SCADUTO AS DTA_SCADENZA_FIDO,
          ST.COD_FASE_PEF VAL_LAST_FASE_PEF,
          ST.COD_STRATEGIA_CRZ VAL_STRATEGIA_CREDIT,
          NULL VAL_LAST_ORGANO_DEL_CP,
          NULL VAL_CONTRASS_ORGANO_DEL_CP,
          ST.FLG_CONFERMA_SAG,
          ST.FLG_ALLINEATO_SAG,
          ST.VAL_SCONFINO,
          I.DTA_ABI_ELAB DTA_LAST_UPDATE,
          ST.COD_STATO_PRECEDENTE,
          ST.DTA_DECORRENZA_STATO,
          ST.COD_PERCORSO,
          --19.03 segnaposto rwa.. da storicizzare..
          TO_NUMBER (NULL) val_rwa
     FROM T_MCRE0_APP_STORICO_EVENTI ST,
          T_MCRE0_APP_UTENTI U,
          MV_MCRE0_DENORM_STR_ORG S,
          MV_MCRE0_APP_ISTITUTI I
    WHERE     NVL (ST.ID_UTENTE, -1) = U.ID_UTENTE                       --(+)
          AND ST.COD_ABI_ISTITUTO = S.COD_ABI_ISTITUTO_FI                --(+)
          AND ST.COD_FILIALE = S.COD_STRUTTURA_COMPETENTE_FI             --(+)
          AND ST.COD_ABI_CARTOLARIZZATO = I.COD_ABI                      --(+)
          AND ST.FLG_CAMBIO_STATO = '1'
          AND ST.FLG_CAMBIO_GESTORE = '0'
          AND ST.FLG_CAMBIO_COMPARTO = '0';
